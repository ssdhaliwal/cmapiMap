<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=7, IE=9, IE=10, IE=11" />
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
	<title>Esri Map for CMAPI using DIV</title>

	<link href="./index-map.css" rel="stylesheet" />
</head>

<body class="claro">
	<div class="box">
		<div class="row header">
			<p><b>header</b>
				<br />
				<br />CMAPI Interface for ESRI Map in IFRAME</p>
		</div>
		<div class="row content">
			<div class="row content toc" style="text-align: center;">
				Select CMAPI Message:</br>
				<select id='configFontSelect'>
					<option value='map.overlay.create'>map.overlay.create</option>
				</select></br>
				<hr /></br>
				Enter text for message:</br>
				<textarea type="text" id="cmapiText" name="cmapiText" rows="20"
					style="width: 95%;height: 300px;"></textarea></br>
				<input type="submit" value="Click to send" style="width: 95%;" onclick="onSubmit();">
				<hr />
				Output from Map:</br>
				<div id="mapMessage"
					style="background-color: #f7f1d8; height: 400px; width: 100%;overflow-y: auto; overflow-x: auto;white-space: nowrap; text-align: left;">
				</div>
			</div>
			<div class="row content data">
				<IFrame id="map" src="/esri-cmapi/index.html" name="cmapiMap" id="cmapiMap" frameborder="0"
					marginwidth="0" marginheight="0" scrolling="auto" onload="" allowtransparency="false"
					style="width:100%; height:100%; display:block;"></IFrame>
			</div>
		</div>
		<div class="row footer">
			<p><b>version 1.0.0</b> &nbsp;S. Dhaliwal</p>
		</div>
	</div>
	<script>
		let map = window.frames.map;

		onSubmit = function () {
			let eOptions = document.getElementById("configFontSelect");
			let message = eOptions.options[eOptions.selectedIndex].value;
			let text = document.getElementById("cmapiText").value;

			console.log(message, text);
			if (text.trim() !== "") {
				map.contentWindow.postMessage(JSON.stringify({"message":message, "value":text}), '*');
			}
			return false;
		};
	</script>
</body>

</html>